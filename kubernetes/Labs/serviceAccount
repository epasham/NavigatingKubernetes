##############
# ServiceAccount
##############
#####
# LAB-1: Create ServiceAccount secret
#####
Create a serviceaccount named venus-sa
Create a service account token Secret for venus-sa named venus-sa-secret 

kubectl -n default create serviceaccount venus-sa
kubectl apply -f - <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: venus-sa-secret
  namespace: default
  annotations:
    kubernetes.io/service-account.name: venus-sa
type: kubernetes.io/service-account-token
EOF

# verify
#!/bin/bash
if [[ $(kubectl get secret venus-sa-secret -o=jsonpath='{.metadata.annotations.kubernetes\.io\/service-account\.name}') = 'venus-sa' ]]
then
  exit 0
else
  exit 1
fi


#####
# LAB-2: Find ServiceAccount token
#####
Team Sun has its own ServiceAccount named sun-sa in Namespace sun. 
A developer requires the token from the Secret that belongs to that ServiceAccount.
Write the base64 decoded token to file /opt/sun/token 

k -n sun get secret sun-sa-secret -oyaml
kubectl -n sun get secret sun-sa-secret -o=jsonpath='{.data.token}'
kubectl -n sun get secret sun-sa-secret -o=jsonpath='{.data.token}' | base64 -d> /opt/sun/token

# verify
#!/bin/bash
if [[ $(kubectl -n sun get secret sun-sa-secret -o=jsonpath='{.data.token}' | base64 -d) = $(cat /opt/sun/token) ]]
then
  exit 0
else
  exit 1
fi
